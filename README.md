## 96TALK ğŸ•¤ - ì–‘ë°©í–¥ í†µì‹  ì›¹ ë©”ì‹ ì € ì„œë¹„ìŠ¤ ğŸ“¨

> 2023 ì„œì¼ëŒ€í•™êµ NINETO6 íŒ€ í”„ë¡œì íŠ¸

<br/>

### ğŸ§‘â€ğŸ’» íŒ€ì› ì†Œê°œ

<table>
  <tr>
  <td align="center">
	    <a href="https://github.com/chang-seop">
	    	<img src="https://avatars.githubusercontent.com/u/66265875?v=4" width="100px;" alt=""/>
	    	<br/>
	    	<sub>
	    	<b>ì‹ ì°½ì„­</b>
	    	<br/>
	    	<img src="https://us-central1-progress-markdown.cloudfunctions.net/progress/100"/>
	        </sub>
	    </a>
	    <br />
	</td>
  <td align="center">
	    <a href="https://github.com/ezurno">
	    	<img src="https://avatars.githubusercontent.com/u/108059303?v=4?s=100" width="100px;" alt=""/>
	    	<br/>
	    	<sub>
	    	<b>ì´ì¤€ëª¨</b>
	    	<br/>
	    	<img src="https://us-central1-progress-markdown.cloudfunctions.net/progress/100"/>
	        </sub>
	    </a>
	</td>
  </tr>
</table>

<br/>

<hr/>

### âš¡í”„ë¡œì íŠ¸ ì†Œê°œ

> 2023.06 - 2023.11

**ì–‘ë°©í–¥ í†µì‹  ì›¹ ë©”ì‹ ì € ì„œë¹„ìŠ¤**

í‰ì†Œì— ìì£¼ì“°ë˜ 'KAKAOTALK', 'LINE' ì„ ë³´ë©° ì›¹ì—ì„œë„ êµ¬í˜„í•´ë³¼ ìˆ˜ ìˆì„ê¹Œ? ë¼ëŠ” ì˜ë¬¸ì— ì‹œì‘í•˜ê²Œ ëœ í”„ë¡œì íŠ¸.

ì›¹ ë¸Œë¼ìš°ì €ì—ëŠ” ì±„íŒ…ë°©ì„ ìƒì„±í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ì±„íŒ…í•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì´ ë§ì´ ì—†ë‹¤ê³  ìƒê°í–ˆì—ˆëŠ”ë°

ë¹„ ì—°ê²°ì„± í”„ë¡œí† ì½œì¸ `Http` í†µì‹  ë°©ì‹ì— ê´€í•´ ê³µë¶€í•˜ê³  ìˆë˜ ì¤‘ `Websocket` ê³¼ ê°™ì€ ì–‘ë°©í–¥ ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ëŠ”

`Simple Text Oriented Messaging Protocol(STOMP)`ì— ëŒ€í•´ ì•Œê²Œ ë˜ì–´ êµ¬í˜„í•´ ë³´ê³ ì í–ˆë‹¤.

 <ul>
  <li>ì‹¤ì‹œê°„ìœ¼ë¡œ ì„œë¡œì˜ ì±„íŒ…ì„ ë³¼ ìˆœ ì—†ì„ê¹Œ? ì—°ê²°í˜• í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì!</li>
  <li>ì „ì†¡ í›„ì— ì—°ê²°ì´ ëŠê¸°ëŠ” `HTTP` ë¥¼ ìœ ì§€ í•  ìˆœ ì—†ì„ê¹Œ? `WebSocket` ì„ í™œìš©í•˜ì! í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì— ë°ì´í„°ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì „ì†¡</li>
  <li>ë©”ì„¸ì§€ë¥¼ ë³´ëƒ„ìœ¼ë¡œì„œ ìƒê¸°ëŠ” ì§€ì—°ì€ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ? `Message Broker` ë¥¼ ì‚¬ìš©í•˜ì!</li>
</ul>

<hr/>
<br/>

### âš™ï¸ ê¸°ìˆ  ì •ë³´

#### Frontend

<div>
<img src="https://img.shields.io/badge/javascript-F7DF1E?style=flat-square&logo=javascript&logoColor=000000"/>
<img src="https://img.shields.io/badge/typescript-3178C6?style=flat-square&logo=typescript&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/react-61DAFB?style=flat-square&logo=react&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/html5-E34F26?style=flat-square&logo=html5&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/css3-1572B6?style=flat-square&logo=css3&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/tailwindcss-06B6D4?style=flat-square&logo=tailwindcss&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/vite-646CFF?style=flat-square&logo=vite&logoColor=FEC111"/>
</div>

#### Backend

<div>
<img src="https://img.shields.io/badge/java-007396?style=flat-square&logo=java&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/spring-6DB33F?style=flat-square&logo=spring&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/springboot-6DB33F?style=flat-square&logo=springboot&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/springsecurity-6DB33F?style=flat-square&logo=springsecurity&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/JWT-007396?style=flat-square&logo=jWT&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/STOMP-007396?style=flat-square&logo=STOMP&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/mybatis-001202?style=flat-square&logo=mybatis&logoColor=FFFFFF"/>

<img src="https://img.shields.io/badge/mysql-4479A1?style=flat-square&logo=mysql&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/redis-DC382D?style=flat-square&logo=redis&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/mongodb-47A248?style=flat-square&logo=mongodb&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/swagger-85EA2D?style=flat-square&logo=swagger&logoColor=FFFFFF"/>
</div>

#### Tool

<div>
<img src="https://img.shields.io/badge/visualstudiocode-007ACC?style=flat-square&logo=visualstudiocode&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/intellij-000000?style=flat-square&logo=intellijidea&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/github-181717?style=flat-square&logo=github&logoColor=FFFFFF"/>
</div>

<br/>
<hr/>

### ğŸš§ ë²„ì „ ê´€ë¦¬ ë° ì§„í–‰

#### Ver 1.0

- [x] ERD ì„¤ê³„ ë° DB í…Œì´ë¸” ìƒì„±
- [x] Spring Security ì„¤ì •
- [x] Access Token êµ¬í˜„ ë° ì¸ì¦ ë°©ì‹ ì¶”ê°€ (JWT, í† í° ë§Œë£Œ 30ë¶„, Authorization í—¤ë”ì— Bearer íƒ€ì…, íœ˜ë°œì„±)
- [x] Refreash Token êµ¬í˜„ (Session ë°©ì‹, ì¿ í‚¤ ë§Œë£Œ 3ì¼, Redis ì‚¬ìš©) 
- [x] Refresh Tokenìœ¼ë¡œ Access Token, Refresh Token ì¬ë°œê¸‰ êµ¬í˜„
- [x] VMWare ë¦¬ëˆ…ìŠ¤ ì„¤ì¹˜ ë° ì„¤ì • 
- [x] nginx ì„¤ì¹˜ ë° ì„¤ì •
- [x] SSL, TLS ì¸ì¦ì„œ ë“±ë¡ (HTTPS)
- [x] Swaggerë¡œ API ê´€ë¦¬
- [x] Refresh Token ë³´ì•ˆ ì„¤ì • (httpOnly, secure)
- [x] ë¡œê·¸ì¸, íšŒì›ê°€ì… êµ¬í˜„ 
- [x] í”„ë¡œí•„ ìˆ˜ì •, í”„ë¡œí•„ ìƒì„¸ ë©”ì„¸ì§€
- [x] ì¹œêµ¬ì¶”ê°€ ë° ì±„íŒ…ë°© ê°œì„¤ êµ¬í˜„
- [x] ì¹œêµ¬ëª©ë¡ ì¡°íšŒ êµ¬í˜„
- [x] ì±„íŒ…ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ êµ¬í˜„
- [x] ì‹¤ì‹œê°„ ì±„íŒ… êµ¬í˜„
- [x] ì±„íŒ… ë²„ë¸” ë° ì•ˆì½ì€ ì±„íŒ… í‘œì‹œ êµ¬í˜„
- [x] ì±„íŒ… ê¸°ëŠ¥ì„ ì‘ìš©í•˜ì—¬ ì•ŒëŒ ê¸°ëŠ¥ êµ¬í˜„
- [x] ê° ìš”ì²­ ì˜ˆì™¸ ì²˜ë¦¬ ë° ë²„ê·¸ ìˆ˜ì •

#### Ver 2.0

- [ ] ì±„íŒ…ë°© ì±„íŒ… ë©”ì„¸ì§€ Lazy-Loading êµ¬í˜„ (ì„±ëŠ¥ ìµœì í™”)
- [ ] ë‹¨ì²´ ì±„íŒ…ë°© êµ¬í˜„
- [ ] ì±„íŒ…ë°© ì´ë¯¸ì§€ ì—…ë¡œë“œ êµ¬í˜„
- [ ] ì±„íŒ…ë°©ì— ì—…ë¡œë“œ ëœ ì´ë¯¸ì§€ 30ì¼ ë’¤ ì œê±° (Spring Batch ì´ìš©)

<br/>
<hr/>

## ğŸ’¡ í”„ë¡œì íŠ¸ ì‹¤í–‰ ì´ë¯¸ì§€
#### ìµœì´ˆ í™”ë©´, ë¡œê·¸ì¸
![1ë²ˆ ì´ë¯¸ì§€](./assets/images/1.png)
#### íšŒì› ê°€ì…
![2ë²ˆ ì´ë¯¸ì§€](./assets/images/2.png)
#### ë¡œê·¸ì¸ í›„ ì¹œêµ¬ ëª©ë¡
![3ë²ˆ ì´ë¯¸ì§€](./assets/images/3.png)
#### í”„ë¡œí•„ ìƒì„¸
![4ë²ˆ ì´ë¯¸ì§€](./assets/images/4.png)
#### í”„ë¡œí•„ ìˆ˜ì •
![5ë²ˆ ì´ë¯¸ì§€](./assets/images/5.png)
#### ì¹´ë©”ë¼ ë²„íŠ¼ì„ ëˆŒëŸ¬ í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆ˜ì •
![6ë²ˆ ì´ë¯¸ì§€](./assets/images/6.png)
#### í”„ë¡œí•„ ì‚¬ì§„ì´ ìˆ˜ì •ëœ ì¹œêµ¬ ëª©ë¡
![7ë²ˆ ì´ë¯¸ì§€](./assets/images/7.png)
#### ì¹œêµ¬ ê²€ìƒ‰
![8ë²ˆ ì´ë¯¸ì§€](./assets/images/8.png)
#### ê²€ìƒ‰ëœ ì¹œêµ¬ì˜ í”„ë¡œí•„
![9ë²ˆ ì´ë¯¸ì§€](./assets/images/9.png)
#### ì¹œêµ¬ì˜ í”„ë¡œí•„ ìƒì„¸
![10ë²ˆ ì´ë¯¸ì§€](./assets/images/10.png)
#### ì¹œêµ¬ì™€ì˜ ì±„íŒ…ì°½, 1:1 ì±„íŒ…
![11ë²ˆ ì´ë¯¸ì§€](./assets/images/11.png)
![12ë²ˆ ì´ë¯¸ì§€](./assets/images/12.png)
![13ë²ˆ ì´ë¯¸ì§€](./assets/images/13.png)
#### ì¹œêµ¬ê°€ ì¶”ê°€ëœ ì¹œêµ¬ ëª©ë¡, ì±„íŒ… ë©”ì„¸ì§€ ì•ŒëŒ(ë²„ë¸”)
![14ë²ˆ ì´ë¯¸ì§€](./assets/images/14.png)
#### ë©”ì„¸ì§€ ë¯¸ë¦¬ë³´ê¸°, ë©”ì„¸ì§€ ì•Œë¦¼
![15ë²ˆ ì´ë¯¸ì§€](./assets/images/15.png)
![16ë²ˆ ì´ë¯¸ì§€](./assets/images/16.png)
#### ì±„íŒ…ë°©ì„ ë„ê²Œ ë˜ë©´ ì•ŒëŒì´ ì—†ì–´ì§„ ëª¨ìŠµ
![17ë²ˆ ì´ë¯¸ì§€](./assets/images/17.png)
#### ì±„íŒ…ë°© ì˜¤ë¥¸ìª½ ìƒë‹¨ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„(í† ê¸€) ì±„íŒ…ë°© ë‚˜ê°€ê¸°
![18ë²ˆ ì´ë¯¸ì§€](./assets/images/18.png)
#### ì±„íŒ…ë°©ì„ ë‚˜ì˜¤ê²Œ ëœ ëª¨ìŠµ
![19ë²ˆ ì´ë¯¸ì§€](./assets/images/19.png)

## ğŸ” í”„ë¡œì íŠ¸ ìƒì„¸
#### Swagger

[Swagger API ëª…ì„¸ì„œ](https://nineto6.p-e.kr/api/swagger-ui/index.html#/)

![image-swagger](./assets/image-swagger.jpg)

#### ERD-Cloud

![image-erd](./assets/image-erd.png)

<br/>
<hr/>

### ğŸŒ³ ê°œë°œ í™˜ê²½

#### Frontend

- Project: React ^18.2.0
- Language: typescript ^4.9.5
- Dependencies
  - react-hook-form: ^7.48.2
  - react-helmet: ^6.1.0
  - axios: ^1.6.1
  - sockjs-client: ^1.6.1
  - @stomp/stompjs: ^7.0.0
  - tailwindcss: ^3.3.5

#### Backend

- Project: Gradle
- SpringBoot: 2.7.17
- Language: Java 11
- Dependencies
  - jjwt: 0.9.1
  - json-simple: 1.1.1
  - jaxb-runtime: 2.3.2
  - springdoc-openapi-ui: 1.7.0
  - mybatis-spring-boot-starter:2.3.1
  - spring-boot-starter-security
  - spring-boot-starter-web
  - spring-boot-starter-websocket
  - spring-boot-starter-validation
  - spring-boot-starter-data-mongodb
  - spring-boot-starter-data-redis
  - spring-boot-starter-test
  - mysql-connector-j
  - lombok

<br/>
<hr/>

### ë°°í¬ ê³¼ì •
#### ì‚¬ìš© íˆ´
- VMWare Workstation 17 player, Putty, FileZilla
- HostOS: Windows 11
- guestOS: CentOS Stream 9

#### ë²„ì „
- nginx: 1.20.1
- Redis: 6.2.7
- MySQL: 8.4.1
- MongoDB: 7.0.12
- JDK: 17.0.6

#### ìˆœì„œ
1. ê°€ìƒ OS VM Ware í”„ë¡œê·¸ë¨ ì„¤ì¹˜
2. ìš´ì˜ì²´ì œ CentOS Stream 9 ì„¤ì¹˜
3. Puttyë¡œ ì ‘ì†í•  ê´€ë¦¬ì ê³„ì • ìƒì„±
4. ì ‘ì†ì€ ì™¸ë¶€ ì„œë²„ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì—¬ Puttyë¡œ SSH ì ‘ì† ë° íŒŒì¼ì€ FileZillaë¥¼ í†µí•´ íŒŒì¼ ì˜®ê¸°ê¸°
5. Java Development Kit(JDK) ì„¤ì¹˜
6. nginx ì„¤ì¹˜, ì ‘ì† í…ŒìŠ¤íŠ¸
7. Host OS ê³µìœ ê¸°ì— í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443), VMWare í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443 ì™¸ë¶€ ì ‘ì† í—ˆìš©)
8. Firewall(ë°©í™”ë²½) 80, 443 í¬íŠ¸ ì—´ê¸°
9. 'ë‚´ë„ë©”ì¸.í•œêµ­' ë¬´ë£Œ DNS ì‚¬ìš© ë° Host ì™¸ë¶€ IP ì—°ê²°
10. MySQL, Redis, MongoDB ì„¤ì¹˜ ë° ê³„ì • ìƒì„±, ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° í…Œì´ë¸” ì¶”ê°€
11. Spring Boot ì´ìš©í•˜ì—¬ ë¹Œë“œ(BootJar) í›„ íŒŒì¼ systemctl(ì„œë¹„ìŠ¤) ë“±ë¡
12. Certbot ì´ìš©í•˜ì—¬ ë¬´ë£Œ lets' encrypt SSL/TLS ì„¤ì¹˜ ë° nginx.conf íŒŒì¼ ì„¤ì •
13. ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° ì™¸ë¶€ ì‚¬ìš©ì ì ‘ì† í…ŒìŠ¤íŠ¸

#### nginx.conf
```nginx
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    client_max_body_size 10M;

    upstream app {
       server 127.0.0.1:8080;
    }

    underscores_in_headers on;
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Redirect all Traffic to HTTPS
    server {
      listen 80;

	  location ~ /\.well-known/acme-challenge/ {
	  	allow all;
		root /var/www/letsencrypt;
	  }

      return 301 https://$host$request_uri;
    }
 
    server {
      listen 443 ssl http2;
      ssl_certificate /etc/letsencrypt/live/nineto6.p-e.kr/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/nineto6.p-e.kr/privkey.pem;

      # Disable SSL
      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
     
      # í†µì‹ ê³¼ì •ì—ì„œ ì‚¬ìš©í•  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜
      ssl_prefer_server_ciphers on;
      ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;

      # Enable HSTS
      # clientì˜ browserì—ê²Œ httpë¡œ ì–´ë– í•œ ê²ƒë„ loadí•˜ì§€ ë§ë¼ê³  ê·œì œí•©ë‹ˆë‹¤.
      add_header Strict-Transport-Security "max-age=31536000" always;

      # SSL sessions
      ssl_session_cache shared:SSL:10m;
      ssl_session_timeout 10m;
    
      # Back-End Websocket
      location ^~/api/ws/ {
        proxy_pass http://app;
 
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
      }

      # Back-End API
      location ^~/api/ {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Nginx-Proxy true;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }

      # Front-End React
      location / {
        root /home/ikavon/react/build;
        index index.html;
      	try_files $uri $uri/ /index.html;
      } 
    }
}
```

#### 96talk.service
```
[Unit]
Description=Service Description
After=syslog.target network.target 96talk.service

[Service]
ExecStart=/bin/bash -c "exec java -jar /home/ikavon/server/96talk/96Talk-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod"
Restart=on-failure
RestartSec=10

User=root
Group=root

[Install]
WantedBy=multi-user.target
```
